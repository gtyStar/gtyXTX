import{A as s,C as y,m as i,I as n,p as A,E}from"./index-Beia3Hnk.js";import{E as k}from"./overlay-D6WyM4xu.js";import"./button-ITJ7J-sp.js";import"./input-DQ3j-lNY.js";const b=()=>s({url:"/member/cart"}),S=(t,l)=>s({url:"/member/cart",method:"post",data:{skuId:t,count:l}}),x=(t,l,c)=>s({url:"/member/cart/merge",method:"post",data:[{skuId:t,selected:l,count:c}]}),m=t=>s({url:"/member/cart",method:"delete",data:{ids:t}}),B=(t,l,c)=>s({url:`/member/cart/${t}`,method:"put",data:{selected:l,count:c}}),j=y("cart",()=>{const t=i([]),l=async()=>{const e=await b();e!=null&&e.result&&(t.value=e.result,t.value.forEach(a=>{a.loading=!1}),t.value.forEach(a=>{a.selected=!1}),r.value=!1)},c=n(()=>t.value.reduce((e,a)=>e+a.count,0)),v=n(()=>t.value.reduce((e,a)=>e+a.count*a.nowPrice,0)),C=async e=>{t.value.find(u=>e.skuId===u.skuId)?(await x(e.skuId,e.selected,e.count),l()):(await S(e.skuId,e.count),l())},o=i(!1),h=async([e])=>{o.value=!0,await m([e]),l(),o.value=!1},p=async(e,a,u)=>{t.value.find(d=>d.skuId===e).loading=!0,u===0?k.confirm("你确定要删除该商品名？","再删就没有了",{confirmButtonText:"删除",cancelButtonText:"再想想",type:"warning"}).then(async()=>{await m([e]),l(),E.success("删除成功")}).catch(()=>{l()}):(await B(e,a,u),await l()),t.value.find(d=>d.skuId===e).loading=!1},r=i(!1),w=()=>{r.value=!r.value,t.value.forEach(e=>{e.selected=r.value})};A(t,()=>{t.value.length===0&&(r.value=!1)});const f=()=>{console.log(1),t.value.every(e=>e.selected===!0)?r.value=!0:r.value=!1},g=e=>{t.value[e].selected=!t.value[e].selected,f()},I=n(()=>t.value.filter(e=>e.selected===!0).reduce((e,a)=>e+a.count,0)),P=n(()=>t.value.filter(e=>e.selected===!0).reduce((e,a)=>e+a.count*a.nowPrice,0));return{cartList:t,getCartList:l,allCount:c,allPrice:v,addCart:C,delCart:h,loading:o,updateCart:p,singleCheck:g,allCheckSelected:r,isAllSelected:f,allCheck:w,selectedCount:I,selectedPrice:P}});export{j as u};
