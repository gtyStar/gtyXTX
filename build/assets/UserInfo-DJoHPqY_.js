import{u as Y,y as Z,E as w}from"./user-B09vwgLD.js";import{v as ee}from"./loading-DA6otzSy.js";import{u as ae,E as le,a as se,b as oe,s as _,e as B,d as te,c as re}from"./element-china-area-data-BCSFisLO.js";import{E as de}from"./overlay-DwIeZBQP.js";import{E as ue,a as ne}from"./form-item-Cb1zT7hY.js";import{E as ie}from"./input-Ca_RZ81r.js";import"./popper-DhFSmpAh.js";import"./scrollbar-BzhKjxuj.js";import{E as ve}from"./checkbox-CqaEmTU6.js";import{E as ce}from"./button-Z5oPM18n.js";import{G as pe}from"./GoodsItem-B37hbbu0.js";import{_ as fe,l as i,k as $,m as F,c as f,i as ge,d as t,a as s,u as x,t as E,F as A,j as M,w as u,o as c,h as me,b as n}from"./index-DsM5QmqD.js";import{E as D}from"./index-BCqg8NeN.js";import"./event-BB_Ol6Sd.js";import"./error-Cq9Fpw4b.js";import"./strings-XoMxCkFC.js";import"./isEqual-BRqSHAuy.js";import"./focus-trap-CFV13DVw.js";import"./scroll-C1TE8oWP.js";import"./debounce-CJKWcNqm.js";import"./vnode-4Ur0teIC.js";import"./castArray-Del_7CoE.js";const Ce={class:"home-overview"},ye={class:"user-meta"},be={class:"avatar"},we=["src"],_e={class:"item"},ke={class:"like-container"},Ve={class:"home-panel"},xe={class:"goods-list"},Ee={key:0,class:"addressWrapper"},he={class:"edit"},Te=["onClick"],Ae={key:1,style:{height:"150px","line-height":"150px","text-align":"center"}},De={class:"dialog-footer"},Se={class:"demo-drawer__content"},Ue={key:0,class:"demo-drawer__footer",style:{display:"flex","justify-content":"flex-end"}},Ie={key:1,class:"demo-drawer__footer",style:{display:"flex","justify-content":"flex-end"}},Le={__name:"UserInfo",setup(je){const S=Y(),U=i([]),I=i(!0),P=async()=>{const l=await Z({limit:4});U.value=l.result,I.value=!1};$(()=>{P()});const h=i(!1),p=i(!1),g=ae(),y=i(!0);$(async()=>{await g.getAddress(),g.userAddresses.length===0?y.value=!1:y.value=!0}),F(()=>g.userAddresses,l=>{l.length===0?y.value=!1:y.value=!0});const N=async l=>{de.confirm("确定要删除该地址吗？","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=D.service({lock:!0,text:"正在加载中😍😍😍",background:"rgba(0, 0, 0, 0.1)"});await te(l),await g.getAddress(),e.close(),console.log(_)})},G=async l=>{console.log(l);const e={receiver:l.receiver,contact:l.contact,provinceCode:l.provinceCode,cityCode:l.cityCode,countyCode:l.countyCode,address:l.address,postalCode:l.postalCode,addressTags:l.addressTags,isDefault:l.isShow?0:1},d=await B(l.id,e);g.getAddress(),console.log(d)},a=i({receiver:"",contact:"",area:[],address:"",postalCode:"",addressTags:"",isShow:!1}),T=i(null),L=()=>{a.value={receiver:"",contact:"",area:[],address:"",postalCode:"",addressTags:"",isShow:!1}},R=i({receiver:[{required:!0,message:"请填写收货人姓名",trigger:"blur"}],contact:[{required:!0,message:"请填写收货人联系方式",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],area:[{required:!0,message:"请选择省市区/县",trigger:"blur"}],address:[{required:!0,message:"请填写详细地址",trigger:"blur"}],postalCode:[{required:!0,message:"请填写邮编",trigger:"blur"},{pattern:/^[1-9]\d{5}$/,message:"请输入正确的邮编",trigger:"blur"}],addressTags:[{required:!0,message:"请填写地址标签",trigger:"blur"}],const:[{required:!1,message:"请选择是否设为默认地址",trigger:"blur"}]}),k=i(""),z=()=>{p.value=!0,k.value="添加地址"},W=async()=>{console.log(a.value);const l=i([]);_.map(d=>{d.label===a.value.area[0]&&(l.value.push(d.value+"0000"),d.children.map(r=>{r.label===a.value.area[1]&&(l.value.push(r.value+"00"),r.children.map(m=>{m.label===a.value.area[2]&&l.value.push(m.value)}))}))});const e={receiver:a.value.receiver,contact:a.value.contact,provinceCode:l.value[0],cityCode:l.value[1],countyCode:l.value[2],address:a.value.address,postalCode:a.value.postalCode,addressTags:a.value.addressTags,isDefault:a.value.isShow?0:1,fullLocation:a.value.area.join(" ")+a.value.address};console.log(e),T.value.validate(async d=>{if(d){const r=D.service({lock:!0,text:"正在加载中😍😍😍",background:"rgba(0, 0, 0, 0.1)"});await re(e),await g.getAddress(),p.value=!1,r.close(),w.success("添加成功")}else w.error("请填写完整信息")})},v=i({}),H=async l=>{p.value=!0,k.value="修改地址",v.value={...l},a.value.receiver=l.receiver,a.value.contact=l.contact,a.value.provinceCode=l.provinceCode,a.value.cityCode=l.cityCode,a.value.countyCode=l.countyCode,a.value.address=l.address,a.value.postalCode=l.postalCode,a.value.addressTags=l.addressTags,a.value.isDefault=l.isDefault,a.value.isShow=!l.isDefault,a.value.fullLocation=l.fullLocation,a.value.id=l.id,console.log(l),_.map(e=>{e.value+"0000"===a.value.provinceCode&&(a.value.area.push(e.label),e.children.map(d=>{d.value+"00"===a.value.cityCode&&(a.value.area.push(d.label),d.children.map(r=>{r.value===a.value.countyCode&&a.value.area.push(r.label)}))})),v.value.area=a.value.area}),console.log(a.value)},J=async()=>{const l=i([]);_.map(d=>{d.label===a.value.area[0]&&(l.value.push(d.value+"0000"),d.children.map(r=>{r.label===a.value.area[1]&&(l.value.push(r.value+"00"),r.children.map(m=>{m.label===a.value.area[2]&&l.value.push(m.value)}))}))});const e={receiver:a.value.receiver,contact:a.value.contact,provinceCode:l.value[0],cityCode:l.value[1],countyCode:l.value[2],address:a.value.address,postalCode:a.value.postalCode,addressTags:a.value.addressTags,isDefault:a.value.isShow?0:1,fullLocation:a.value.area.join(" ")};if(console.log(a.value.id,e),console.log(e),console.log(v.value),console.log(a.value.area),e.receiver===v.value.receiver&&e.contact===v.value.contact&&a.value.area===v.value.area&&e.address===v.value.address&&e.postalCode===v.value.postalCode&&e.addressTags===v.value.addressTags&&e.isDefault===v.value.isDefault){w.warning("请修改表单内容");return}else T.value.validate(async d=>{if(d){const r=D.service({lock:!0,text:"正在加载中😍😍😍",background:"rgba(0, 0, 0, 0.1)"});await B(a.value.id,e),await g.getAddress(),p.value=!1,r.close(),w.success("修改成功")}else w.error("请填写正确信息")})};return F(()=>p.value,l=>{l||L()}),(l,e)=>{var j,q;const d=ve,r=ce,m=le,b=ie,C=ne,K=oe,O=ue,Q=se,X=ee;return c(),f(A,null,[ge((c(),f("div",null,[s("div",Ce,[s("div",ye,[s("div",be,[s("img",{src:(j=x(S).userInfo)==null?void 0:j.avatar},null,8,we)]),s("h4",null,E((q=x(S).userInfo)==null?void 0:q.account),1)]),s("div",_e,[e[13]||(e[13]=s("a",{href:"javascript:;"},[s("span",{class:"iconfont icon-hy"}),s("p",null,"会员中心")],-1)),e[14]||(e[14]=s("a",{href:"javascript:;"},[s("span",{class:"iconfont icon-aq"}),s("p",null,"安全设置")],-1)),s("a",{href:"javascript:;",onClick:e[0]||(e[0]=o=>h.value=!0)},e[12]||(e[12]=[s("span",{class:"iconfont icon-dw"},null,-1),s("p",null,"地址管理",-1)]))])]),s("div",ke,[s("div",Ve,[e[15]||(e[15]=s("div",{class:"header"},[s("h4",{"data-v-bcb266e0":""},"猜你喜欢")],-1)),s("div",xe,[(c(!0),f(A,null,M(U.value,o=>(c(),me(pe,{key:o.id,goods:o},null,8,["goods"]))),128))])])])])),[[X,I.value]]),t(m,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=o=>h.value=o),title:"地址管理",width:"30%",center:""},{footer:u(()=>[s("span",De,[t(r,{onClick:z,type:"primary"},{default:u(()=>e[23]||(e[23]=[n("添加地址")])),_:1})])]),default:u(()=>[y.value?(c(),f("div",Ee,[(c(!0),f(A,null,M(x(g).userAddresses,o=>(c(),f("div",{class:"text item",key:o.id},[s("ul",null,[s("li",null,[e[16]||(e[16]=s("span",null,[n("收"),s("i"),n("货"),s("i"),n("人：")],-1)),n(E(o.receiver),1)]),s("li",null,[e[17]||(e[17]=s("span",null,"联系方式：",-1)),n(E(o.contact),1)]),s("li",null,[e[18]||(e[18]=s("span",null,"收货地址：",-1)),n(E(o.fullLocation+o.address),1)])]),s("div",he,[t(d,{modelValue:o.isShow,"onUpdate:modelValue":V=>o.isShow=V,onChange:V=>G(o)},{default:u(()=>e[19]||(e[19]=[n(" 默认 ")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),s("i",{class:"iconfont icon-close-new del",onClick:V=>N(o.id)},e[20]||(e[20]=[s("span",{style:{"font-size":"14px","margin-left":"5px"}},"删除",-1)]),8,Te),t(r,{onClick:V=>H(o),style:{"margin-top":"6px"}},{default:u(()=>e[21]||(e[21]=[n("修改")])),_:2},1032,["onClick"])])]))),128))])):(c(),f("div",Ae,e[22]||(e[22]=[s("p",null,"您还没有收货地址，去添加吧💖💖💖",-1)])))]),_:1},8,["modelValue"]),t(Q,{modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=o=>p.value=o),title:k.value},{default:u(()=>[s("div",Se,[t(O,{ref_key:"addressFormRef",ref:T,style:{"max-width":"600px"},model:a.value,rules:R.value,"label-width":"auto","label-position":"left"},{default:u(()=>[t(C,{label:"收货人昵称",prop:"receiver"},{default:u(()=>[t(b,{modelValue:a.value.receiver,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.receiver=o),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),t(C,{label:"收货人手机号",prop:"contact"},{default:u(()=>[t(b,{modelValue:a.value.contact,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.contact=o),placeholder:"手机号"},null,8,["modelValue"])]),_:1}),t(C,{label:"请选择地址",prop:"area"},{default:u(()=>[t(K,{style:{width:"100%"},modelValue:a.value.area,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.area=o),options:x(_),props:{value:"label",label:"label",expandTrigger:"click"},placeholder:"请选择"},null,8,["modelValue","options"])]),_:1}),t(C,{label:"详细地址",prop:"address"},{default:u(()=>[t(b,{modelValue:a.value.address,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.address=o),placeholder:"区以下的详细地址"},null,8,["modelValue"])]),_:1}),t(C,{label:"所在地邮政编码",prop:"postalCode"},{default:u(()=>[t(b,{modelValue:a.value.postalCode,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.postalCode=o),placeholder:"邮政编码"},null,8,["modelValue"])]),_:1}),t(C,{label:"地址标签",prop:"addressTags"},{default:u(()=>[t(b,{modelValue:a.value.addressTags,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.addressTags=o),placeholder:"地址标签"},null,8,["modelValue"])]),_:1}),t(C,{label:"设为默认地址"},{default:u(()=>[t(d,{modelValue:a.value.isShow,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.isShow=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),k.value==="添加地址"?(c(),f("div",Ue,[t(r,{onClick:e[9]||(e[9]=o=>p.value=!1)},{default:u(()=>e[24]||(e[24]=[n("取消")])),_:1}),t(r,{onClick:L},{default:u(()=>e[25]||(e[25]=[n("清空")])),_:1}),t(r,{type:"primary",onClick:W},{default:u(()=>e[26]||(e[26]=[n("添加")])),_:1})])):(c(),f("div",Ie,[t(r,{onClick:e[10]||(e[10]=o=>p.value=!1)},{default:u(()=>e[27]||(e[27]=[n("取消")])),_:1}),t(r,{type:"primary",onClick:J},{default:u(()=>e[28]||(e[28]=[n("提交")])),_:1})]))])]),_:1},8,["modelValue","title"])],64)}}},sa=fe(Le,[["__scopeId","data-v-42bbb892"]]);export{sa as default};
