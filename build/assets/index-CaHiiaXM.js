import{h as H}from"./user-CZ75d7cD.js";import{E as q,a as R}from"./tab-pane-DHa-IMe9.js";import{E as j,a as G}from"./breadcrumb-item-YYLczz6o.js";import{G as M}from"./GoodsItem-HQSj5XL7.js";import{O as I,P as U,q as v,m as $,j as O,p as A,_ as z,c as y,a as N,d as f,w as E,h as K,H as L,u as m,F as Y,i as J,o as g,b as T,t as D,g as Q}from"./index-Jc5nUXXn.js";import"./loading-Dk_94Yj5.js";import{E as W}from"./index-DRxav3BL.js";import{t as X}from"./error-Cq9Fpw4b.js";import{g as Z}from"./scroll-D5DzH0qg.js";import{t as k}from"./throttle-DbVbr3-u.js";import"./strings-C1UMSFeL.js";import"./event-BB_Ol6Sd.js";import"./index-CAe98fAi.js";import"./vnode-CjczZi7E.js";import"./debounce-CS5mnlNn.js";const V=e=>{let o=0,t=e;for(;t;)o+=t.offsetTop,t=t.offsetParent;return o},ee=(e,o)=>Math.abs(V(e)-V(o)),d="ElInfiniteScroll",te=50,oe=200,se=0,ae={delay:{type:Number,default:oe},distance:{type:Number,default:se},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},F=(e,o)=>Object.entries(ae).reduce((t,[s,l])=>{var c,n;const{type:u,default:r}=l,a=e.getAttribute(`infinite-scroll-${s}`);let i=(n=(c=o[a])!=null?c:a)!=null?n:r;return i=i==="false"?!1:i,i=u(i),t[s]=Number.isNaN(i)?r:i,t},{}),B=e=>{const{observer:o}=e[d];o&&(o.disconnect(),delete e[d].observer)},ne=(e,o)=>{const{container:t,containerEl:s,instance:l,observer:c,lastScrollTop:n}=e[d],{disabled:u,distance:r}=F(e,l),{clientHeight:a,scrollHeight:i,scrollTop:b}=s,_=b-n;if(e[d].lastScrollTop=b,c||u||_<0)return;let h=!1;if(t===e)h=i-(a+b)<=r;else{const{clientTop:S,scrollHeight:p}=e,P=ee(e,s);h=b+a>=P+S+p-r}h&&o.call(l)};function w(e,o){const{containerEl:t,instance:s}=e[d],{disabled:l}=F(e,s);l||t.clientHeight===0||(t.scrollHeight<=t.clientHeight?o.call(s):B(e))}const re={async mounted(e,o){const{instance:t,value:s}=o;U(s)||X(d,"'v-infinite-scroll' binding value must be a function"),await I();const{delay:l,immediate:c}=F(e,t),n=Z(e,!0),u=n===window?document.documentElement:n,r=k(ne.bind(null,e,s),l);if(n){if(e[d]={instance:t,container:n,containerEl:u,delay:l,cb:s,onScroll:r,lastScrollTop:u.scrollTop},c){const a=new MutationObserver(k(w.bind(null,e,s),te));e[d].observer=a,a.observe(e,{childList:!0,subtree:!0}),w(e,s)}n.addEventListener("scroll",r)}},unmounted(e){if(!e[d])return;const{container:o,onScroll:t}=e[d];o==null||o.removeEventListener("scroll",t),B(e)},async updated(e){if(!e[d])await I();else{const{containerEl:o,cb:t,observer:s}=e[d];o.clientHeight&&s&&w(e,t)}}},C=re;C.install=e=>{e.directive("InfiniteScroll",C)};const le=C,ie=e=>H({url:"/category/sub/filter",params:{id:e}}),x=e=>H({url:"/category/goods/temporary",method:"post",data:e}),ce=()=>{const e=A(),o=v([]),t=async s=>{const l=await ie(s);o.value=l.result};return $(()=>e.params.id,async s=>{await t(s)}),O(()=>{t(e.params.id)}),{subCategoryFilterData:o}},ue=()=>{const e=A(),o=v([]),t=v({categoryId:e.params.id,page:1,pageSize:20,sortField:"publishTime"}),s=async()=>{const r=W.service({lock:!0,text:"正在加载中😍😍😍",background:"rgba(0, 0, 0, 0.1)"});console.log(t.value);const a=await x(t.value);o.value=a.result.items,r.close()},l=r=>{t.value.sortField=r,t.value.page=1,s()},c=v(!1),n=v(!1),u=async()=>{n.value=!0,t.value.page++;const r=await x(t.value);o.value=[...o.value,...r.result.items],n.value=!1,r.result.items.length===0&&(c.value=!0)};return O(()=>s()),{goodList:o,reqData:t,changeReqData:l,load:u,disabled:c,loading:n}},de={class:"container"},me={class:"bread-container"},fe={class:"sub-container"},pe=["infinite-scroll-disabled"],be={key:0,class:"more"},ge={key:1,class:"more"},ve=Object.assign({name:"SubCategory"},{__name:"index",setup(e){const{subCategoryFilterData:o}=ce(),{goodList:t,changeReqData:s,load:l,disabled:c,loading:n}=ue(),u=v("publishTime");return(r,a)=>{const i=G,b=j,_=R,h=q,S=le;return g(),y("div",de,[N("div",me,[f(b,{separator:">"},{default:E(()=>[f(i,{to:{path:"/"}},{default:E(()=>a[2]||(a[2]=[T("首页")])),_:1}),f(i,{to:{path:`/category/${m(o).parentId}`}},{default:E(()=>[T(D(m(o).parentName),1)]),_:1},8,["to"]),f(i,null,{default:E(()=>[T(D(m(o).name),1)]),_:1})]),_:1})]),N("div",fe,[f(h,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=p=>u.value=p),onTabChange:a[1]||(a[1]=p=>m(s)(u.value))},{default:E(()=>[f(_,{label:"最新商品",name:"publishTime"}),f(_,{label:"最高人气",name:"orderNum"}),f(_,{label:"评论最多",name:"evaluateNum"})]),_:1},8,["modelValue"]),K((g(),y("div",{class:"body","infinite-scroll-disabled":m(c)},[(g(!0),y(Y,null,J(m(t),p=>(g(),Q(M,{key:p.id,goods:p},null,8,["goods"]))),128))],8,pe)),[[S,m(l)]]),m(n)?(g(),y("div",be,"加载中。。。😂😂")):L("",!0),m(c)?(g(),y("div",ge,"没有更多了😘😘")):L("",!0)])])}}}),xe=z(ve,[["__scopeId","data-v-b072f936"]]);export{xe as default};
