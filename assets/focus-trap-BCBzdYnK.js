import{Z as $,F as q,G as Q,_ as se,p as oe}from"./user-DeiOFHGz.js";import{j as N,B as R,p as S,G as re,q as ae,v as C,u as T,O as M,z as ue,C as ce}from"./index-D2_cjRjC.js";const ie='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',de=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Ce=e=>Array.from(e.querySelectorAll(ie)).filter(n=>ee(n)&&de(n)),ee=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},fe=e=>!e.getAttribute("aria-owns"),Oe=(e,n,o)=>{const{parentNode:s}=e;if(!s)return null;const a=s.querySelectorAll(o),u=Array.prototype.indexOf.call(a,e);return a[u+n]||null},we=e=>{e&&(e.focus(),!fe(e)&&e.click())},O="focus-trap.focus-after-trapped",w="focus-trap.focus-after-released",le="focus-trap.focusout-prevented",j={cancelable:!0,bubbles:!1},ve={cancelable:!0,bubbles:!1},G="focusAfterTrapped",W="focusAfterReleased",pe=Symbol("elFocusTrap"),I=S(),_=S(0),x=S(0);let m=0;const te=e=>{const n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n},z=(e,n)=>{for(const o of e)if(!Ee(o,n))return o},Ee=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},be=e=>{const n=te(e),o=z(n,e),s=z(n.reverse(),e);return[o,s]},Te=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,n)=>{if(e&&e.focus){const o=document.activeElement;let s=!1;$(e)&&!ee(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),s=!0),e.focus({preventScroll:!0}),x.value=window.performance.now(),e!==o&&Te(e)&&n&&e.select(),$(e)&&s&&e.removeAttribute("tabindex")}};function J(e,n){const o=[...e],s=e.indexOf(n);return s!==-1&&o.splice(s,1),o}const me=()=>{let e=[];return{push:s=>{const a=e[0];a&&s!==a&&a.pause(),e=J(e,s),e.unshift(s)},remove:s=>{var a,u;e=J(e,s),(u=(a=e[0])==null?void 0:a.resume)==null||u.call(a)}}},Fe=(e,n=!1)=>{const o=document.activeElement;for(const s of e)if(l(s,n),document.activeElement!==o)return},X=me(),ye=()=>_.value>x.value,F=()=>{I.value="pointer",_.value=window.performance.now()},Y=()=>{I.value="keyboard",_.value=window.performance.now()},Se=()=>(N(()=>{m===0&&(document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),document.addEventListener("keydown",Y)),m++}),R(()=>{m--,m<=0&&(document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F),document.removeEventListener("keydown",Y))}),{focusReason:I,lastUserFocusTimestamp:_,lastAutomatedFocusTimestamp:x}),y=e=>new CustomEvent(le,{...ve,detail:e});let p=[];const Z=e=>{e.code===Q.esc&&p.forEach(n=>n(e))},_e=e=>{N(()=>{p.length===0&&document.addEventListener("keydown",Z),q&&p.push(e)}),R(()=>{p=p.filter(n=>n!==e),p.length===0&&q&&document.removeEventListener("keydown",Z)})},Le=re({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[G,W,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const o=S();let s,a;const{focusReason:u}=Se();_e(t=>{e.trapped&&!v.paused&&n("release-requested",t)});const v={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},E=t=>{if(!e.loop&&!e.trapped||v.paused)return;const{code:r,altKey:c,ctrlKey:i,metaKey:d,currentTarget:B,shiftKey:V}=t,{loop:H}=e,ne=r===Q.tab&&!c&&!i&&!d,b=document.activeElement;if(ne&&b){const h=B,[A,P]=be(h);if(A&&P){if(!V&&b===P){const f=y({focusReason:u.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),H&&l(A,!0))}else if(V&&[A,h].includes(b)){const f=y({focusReason:u.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),H&&l(P,!0))}}else if(b===h){const f=y({focusReason:u.value});n("focusout-prevented",f),f.defaultPrevented||t.preventDefault()}}};ce(pe,{focusTrapRef:o,onKeydown:E}),C(()=>e.focusTrapEl,t=>{t&&(o.value=t)},{immediate:!0}),C([o],([t],[r])=>{t&&(t.addEventListener("keydown",E),t.addEventListener("focusin",L),t.addEventListener("focusout",g)),r&&(r.removeEventListener("keydown",E),r.removeEventListener("focusin",L),r.removeEventListener("focusout",g))});const U=t=>{n(G,t)},k=t=>n(W,t),L=t=>{const r=T(o);if(!r)return;const c=t.target,i=t.relatedTarget,d=c&&r.contains(c);e.trapped||i&&r.contains(i)||(s=i),d&&n("focusin",t),!v.paused&&e.trapped&&(d?a=c:l(a,!0))},g=t=>{const r=T(o);if(!(v.paused||!r))if(e.trapped){const c=t.relatedTarget;!oe(c)&&!r.contains(c)&&setTimeout(()=>{if(!v.paused&&e.trapped){const i=y({focusReason:u.value});n("focusout-prevented",i),i.defaultPrevented||l(a,!0)}},0)}else{const c=t.target;c&&r.contains(c)||n("focusout",t)}};async function K(){await M();const t=T(o);if(t){X.push(v);const r=t.contains(document.activeElement)?s:document.activeElement;if(s=r,!t.contains(r)){const i=new Event(O,j);t.addEventListener(O,U),t.dispatchEvent(i),i.defaultPrevented||M(()=>{let d=e.focusStartEl;ue(d)||(l(d),document.activeElement!==d&&(d="first")),d==="first"&&Fe(te(t),!0),(document.activeElement===r||d==="container")&&l(t)})}}}function D(){const t=T(o);if(t){t.removeEventListener(O,U);const r=new CustomEvent(w,{...j,detail:{focusReason:u.value}});t.addEventListener(w,k),t.dispatchEvent(r),!r.defaultPrevented&&(u.value=="keyboard"||!ye()||t.contains(document.activeElement))&&l(s??document.body),t.removeEventListener(w,k),X.remove(v)}}return N(()=>{e.trapped&&K(),C(()=>e.trapped,t=>{t?K():D()})}),R(()=>{e.trapped&&D(),o.value&&(o.value.removeEventListener("keydown",E),o.value.removeEventListener("focusin",L),o.value.removeEventListener("focusout",g),o.value=void 0)}),{onKeydown:E}}});function ge(e,n,o,s,a,u){return ae(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ne=se(Le,[["render",ge],["__file","focus-trap.vue"]]);export{Ne as E,pe as F,ee as a,we as f,Oe as g,fe as i,Ce as o,l as t};
