import{h as H}from"./user-DhrDXGmV.js";import{E as R,a as j}from"./tab-pane-B9J8igAD.js";import{E as q,a as G}from"./breadcrumb-item-BFUymfRc.js";import{G as M}from"./GoodsItem-C3SFNa3C.js";import{O as N,P as U,p as v,v as $,j as O,m as A,_ as z,c as y,a as F,d as f,w as E,h as K,H as L,u as m,F as Y,i as J,o as g,b as T,t as D,g as Q}from"./index-0wKLPFPR.js";import"./loading-Glzj80Wk.js";import{E as W}from"./index-BZp_RQQe.js";import{t as X}from"./error-Cq9Fpw4b.js";import{g as Z}from"./scroll-CNXeUu0p.js";import{t as k}from"./throttle-e7jmVSO8.js";import"./strings-DV3EKIqO.js";import"./event-BB_Ol6Sd.js";import"./index-CHnFGObb.js";import"./vnode-CqQg6st4.js";import"./debounce-B9mwRRbG.js";const V=t=>{let e=0,o=t;for(;o;)e+=o.offsetTop,o=o.offsetParent;return e},tt=(t,e)=>Math.abs(V(t)-V(e)),d="ElInfiniteScroll",et=50,ot=200,st=0,at={delay:{type:Number,default:ot},distance:{type:Number,default:st},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},I=(t,e)=>Object.entries(at).reduce((o,[s,l])=>{var c,r;const{type:u,default:a}=l,n=t.getAttribute(`infinite-scroll-${s}`);let i=(r=(c=e[n])!=null?c:n)!=null?r:a;return i=i==="false"?!1:i,i=u(i),o[s]=Number.isNaN(i)?a:i,o},{}),B=t=>{const{observer:e}=t[d];e&&(e.disconnect(),delete t[d].observer)},nt=(t,e)=>{const{container:o,containerEl:s,instance:l,observer:c,lastScrollTop:r}=t[d],{disabled:u,distance:a}=I(t,l),{clientHeight:n,scrollHeight:i,scrollTop:b}=s,_=b-r;if(t[d].lastScrollTop=b,c||u||_<0)return;let h=!1;if(o===t)h=i-(n+b)<=a;else{const{clientTop:S,scrollHeight:p}=t,P=tt(t,s);h=b+n>=P+S+p-a}h&&e.call(l)};function w(t,e){const{containerEl:o,instance:s}=t[d],{disabled:l}=I(t,s);l||o.clientHeight===0||(o.scrollHeight<=o.clientHeight?e.call(s):B(t))}const rt={async mounted(t,e){const{instance:o,value:s}=e;U(s)||X(d,"'v-infinite-scroll' binding value must be a function"),await N();const{delay:l,immediate:c}=I(t,o),r=Z(t,!0),u=r===window?document.documentElement:r,a=k(nt.bind(null,t,s),l);if(r){if(t[d]={instance:o,container:r,containerEl:u,delay:l,cb:s,onScroll:a,lastScrollTop:u.scrollTop},c){const n=new MutationObserver(k(w.bind(null,t,s),et));t[d].observer=n,n.observe(t,{childList:!0,subtree:!0}),w(t,s)}r.addEventListener("scroll",a)}},unmounted(t){if(!t[d])return;const{container:e,onScroll:o}=t[d];e==null||e.removeEventListener("scroll",o),B(t)},async updated(t){if(!t[d])await N();else{const{containerEl:e,cb:o,observer:s}=t[d];e.clientHeight&&s&&w(t,o)}}},C=rt;C.install=t=>{t.directive("InfiniteScroll",C)};const lt=C,it=t=>H({url:"/category/sub/filter",params:{id:t}}),x=t=>H({url:"/category/goods/temporary",method:"post",data:t}),ct=()=>{const t=A(),e=v([]),o=async s=>{const l=await it(s);e.value=l.result};return $(()=>t.params.id,async s=>{await o(s)}),O(()=>{o(t.params.id)}),{subCategoryFilterData:e}},ut=()=>{const t=A(),e=v([]),o=v({categoryId:t.params.id,page:1,pageSize:20,sortField:"publishTime"}),s=async()=>{const a=W.service({lock:!0,text:"正在加载中😍😍😍",background:"rgba(0, 0, 0, 0.1)"}),n=await x(o.value);e.value=n.result.items,a.close()},l=a=>{console.log(a),o.value.sortField=a,o.value.page=1,s()},c=v(!1),r=v(!1),u=async()=>{r.value=!0,o.value.page++;const a=await x(o.value);e.value=[...e.value,...a.result.items],r.value=!1,a.result.items.length===0&&(c.value=!0)};return O(()=>s()),{goodList:e,reqData:o,changeReqData:l,load:u,disabled:c,loading:r}},dt={class:"container"},mt={class:"bread-container"},ft={class:"sub-container"},pt=["infinite-scroll-disabled"],bt={key:0,class:"more"},gt={key:1,class:"more"},vt=Object.assign({name:"SubCategory"},{__name:"index",setup(t){const{subCategoryFilterData:e}=ct(),{goodList:o,changeReqData:s,load:l,disabled:c,loading:r}=ut(),u=v("publishTime");return(a,n)=>{const i=G,b=q,_=j,h=R,S=lt;return g(),y("div",dt,[F("div",mt,[f(b,{separator:">"},{default:E(()=>[f(i,{to:{path:"/"}},{default:E(()=>n[2]||(n[2]=[T("首页")])),_:1}),f(i,{to:{path:`/category/${m(e).parentId}`}},{default:E(()=>[T(D(m(e).parentName),1)]),_:1},8,["to"]),f(i,null,{default:E(()=>[T(D(m(e).name),1)]),_:1})]),_:1})]),F("div",ft,[f(h,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=p=>u.value=p),onTabChange:n[1]||(n[1]=p=>m(s)(u.value))},{default:E(()=>[f(_,{label:"最新商品",name:"publishTime"}),f(_,{label:"最高人气",name:"orderNum"}),f(_,{label:"评论最多",name:"evaluateNum"})]),_:1},8,["modelValue"]),K((g(),y("div",{class:"body","infinite-scroll-disabled":m(c)},[(g(!0),y(Y,null,J(m(o),p=>(g(),Q(M,{key:p.id,goods:p},null,8,["goods"]))),128))],8,pt)),[[S,m(l)]]),m(r)?(g(),y("div",bt,"加载中。。。😂😂")):L("",!0),m(c)?(g(),y("div",gt,"没有更多了😘😘")):L("",!0)])])}}}),xt=z(vt,[["__scopeId","data-v-b072f936"]]);export{xt as default};
