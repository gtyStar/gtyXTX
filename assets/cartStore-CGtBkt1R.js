import{A as u,C as g,p as v,I as n,q as y,E as A}from"./index-gFBwdwkH.js";import{E}from"./overlay-DuxTGfkv.js";import"./button-Qnm54DsX.js";import"./input-DUBO1Hvq.js";const b=()=>u({url:"/member/cart"}),S=(t,r)=>u({url:"/member/cart",method:"post",data:{skuId:t,count:r}}),B=(t,r,l)=>u({url:"/member/cart/merge",method:"post",data:[{skuId:t,selected:r,count:l}]}),L=t=>u({url:"/member/cart",method:"delete",data:{ids:t}}),M=(t,r,l)=>u({url:`/member/cart/${t}`,method:"put",data:{selected:r,count:l}}),j=g("cart",()=>{const t=v([]),r=async()=>{const e=await b();e!=null&&e.result&&(t.value=e.result,t.value.forEach(a=>{a.loading=!1}))},l=()=>{t.value.forEach(async(e,a)=>{await d(e.skuId,!1,e.count,a)}),c.value=!1},C=n(()=>t.value.reduce((e,a)=>e+a.count,0)),h=n(()=>t.value.reduce((e,a)=>e+a.count*a.nowPrice,0)),p=async e=>{t.value.find(s=>e.skuId===s.skuId)?(await B(e.skuId,e.selected,e.count),r()):(await S(e.skuId,e.count),r())},o=v(!1),m=async([e])=>{o.value=!0,await L([e]),r(),A.success("删除成功"),o.value=!1},d=async(e,a,s,f)=>{t.value[f].loading=!0,s===0?E.confirm("你确定要删除该商品名？","再删就没有了",{confirmButtonText:"删除",cancelButtonText:"再想想",type:"warning"}).then(()=>{m([e])}).catch(()=>{t.value[f].count=1}):(await M(e,a,s),await r()),t.value[f].loading=!1},c=v(!1),w=()=>{c.value?l():(t.value.forEach((e,a)=>{d(e.skuId,!0,e.count,a)}),c.value=!0)};y(t,()=>{t.value.length===0&&(c.value=!1),i()});const i=()=>{t.value.every(e=>e.selected===!0)?c.value=!0:c.value=!1},I=e=>{t.value[e].selected=!t.value[e].selected,i()},k=n(()=>t.value.filter(e=>e.selected===!0).reduce((e,a)=>e+a.count,0)),P=n(()=>t.value.filter(e=>e.selected===!0).reduce((e,a)=>e+a.count*a.nowPrice,0));return{cartList:t,getCartList:r,allCount:C,allPrice:h,addCart:p,delCart:m,loading:o,updateCart:d,singleCheck:I,allCheckSelected:c,isAllSelected:i,allCheck:w,selectedCount:k,selectedPrice:P,clearCheck:l}});export{j as u};
