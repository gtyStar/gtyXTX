import{l as N,L as R,m as S,b1 as $,aB as M,aC as Z,P as se,Q as oe,A as re,p as C,b as T,ag as ae,a5 as q,I as ce,M as ue}from"./index-DRCdeTZm.js";const ie='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',de=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,he=e=>Array.from(e.querySelectorAll(ie)).filter(n=>ee(n)&&de(n)),ee=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},fe=e=>!e.getAttribute("aria-owns"),Ce=(e,n,o)=>{const{parentNode:s}=e;if(!s)return null;const a=s.querySelectorAll(o),c=Array.prototype.indexOf.call(a,e);return a[c+n]||null},we=e=>{e&&(e.focus(),!fe(e)&&e.click())},w="focus-trap.focus-after-trapped",O="focus-trap.focus-after-released",le="focus-trap.focusout-prevented",j={cancelable:!0,bubbles:!1},ve={cancelable:!0,bubbles:!1},W="focusAfterTrapped",J="focusAfterReleased",Ee=Symbol("elFocusTrap"),I=S(),L=S(0),x=S(0);let m=0;const te=e=>{const n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n},Q=(e,n)=>{for(const o of e)if(!pe(o,n))return o},pe=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},be=e=>{const n=te(e),o=Q(n,e),s=Q(n.reverse(),e);return[o,s]},Te=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,n)=>{if(e&&e.focus){const o=document.activeElement;let s=!1;$(e)&&!ee(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),s=!0),e.focus({preventScroll:!0}),x.value=window.performance.now(),e!==o&&Te(e)&&n&&e.select(),$(e)&&s&&e.removeAttribute("tabindex")}};function X(e,n){const o=[...e],s=e.indexOf(n);return s!==-1&&o.splice(s,1),o}const me=()=>{let e=[];return{push:s=>{const a=e[0];a&&s!==a&&a.pause(),e=X(e,s),e.unshift(s)},remove:s=>{var a,c;e=X(e,s),(c=(a=e[0])==null?void 0:a.resume)==null||c.call(a)}}},Fe=(e,n=!1)=>{const o=document.activeElement;for(const s of e)if(l(s,n),document.activeElement!==o)return},Y=me(),ye=()=>L.value>x.value,F=()=>{I.value="pointer",L.value=window.performance.now()},z=()=>{I.value="keyboard",L.value=window.performance.now()},Se=()=>(N(()=>{m===0&&(document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),document.addEventListener("keydown",z)),m++}),R(()=>{m--,m<=0&&(document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F),document.removeEventListener("keydown",z))}),{focusReason:I,lastUserFocusTimestamp:L,lastAutomatedFocusTimestamp:x}),y=e=>new CustomEvent(le,{...ve,detail:e});let E=[];const G=e=>{e.code===Z.esc&&E.forEach(n=>n(e))},Le=e=>{N(()=>{E.length===0&&document.addEventListener("keydown",G),M&&E.push(e)}),R(()=>{E=E.filter(n=>n!==e),E.length===0&&M&&document.removeEventListener("keydown",G)})},_e=oe({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[W,J,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const o=S();let s,a;const{focusReason:c}=Se();Le(t=>{e.trapped&&!v.paused&&n("release-requested",t)});const v={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},p=t=>{if(!e.loop&&!e.trapped||v.paused)return;const{code:r,altKey:u,ctrlKey:i,metaKey:d,currentTarget:B,shiftKey:V}=t,{loop:H}=e,ne=r===Z.tab&&!u&&!i&&!d,b=document.activeElement;if(ne&&b){const A=B,[P,h]=be(A);if(P&&h){if(!V&&b===h){const f=y({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),H&&l(P,!0))}else if(V&&[P,A].includes(b)){const f=y({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),H&&l(h,!0))}}else if(b===A){const f=y({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||t.preventDefault()}}};ue(Ee,{focusTrapRef:o,onKeydown:p}),C(()=>e.focusTrapEl,t=>{t&&(o.value=t)},{immediate:!0}),C([o],([t],[r])=>{t&&(t.addEventListener("keydown",p),t.addEventListener("focusin",_),t.addEventListener("focusout",g)),r&&(r.removeEventListener("keydown",p),r.removeEventListener("focusin",_),r.removeEventListener("focusout",g))});const U=t=>{n(W,t)},k=t=>n(J,t),_=t=>{const r=T(o);if(!r)return;const u=t.target,i=t.relatedTarget,d=u&&r.contains(u);e.trapped||i&&r.contains(i)||(s=i),d&&n("focusin",t),!v.paused&&e.trapped&&(d?a=u:l(a,!0))},g=t=>{const r=T(o);if(!(v.paused||!r))if(e.trapped){const u=t.relatedTarget;!ae(u)&&!r.contains(u)&&setTimeout(()=>{if(!v.paused&&e.trapped){const i=y({focusReason:c.value});n("focusout-prevented",i),i.defaultPrevented||l(a,!0)}},0)}else{const u=t.target;u&&r.contains(u)||n("focusout",t)}};async function K(){await q();const t=T(o);if(t){Y.push(v);const r=t.contains(document.activeElement)?s:document.activeElement;if(s=r,!t.contains(r)){const i=new Event(w,j);t.addEventListener(w,U),t.dispatchEvent(i),i.defaultPrevented||q(()=>{let d=e.focusStartEl;ce(d)||(l(d),document.activeElement!==d&&(d="first")),d==="first"&&Fe(te(t),!0),(document.activeElement===r||d==="container")&&l(t)})}}}function D(){const t=T(o);if(t){t.removeEventListener(w,U);const r=new CustomEvent(O,{...j,detail:{focusReason:c.value}});t.addEventListener(O,k),t.dispatchEvent(r),!r.defaultPrevented&&(c.value=="keyboard"||!ye()||t.contains(document.activeElement))&&l(s??document.body),t.removeEventListener(O,k),Y.remove(v)}}return N(()=>{e.trapped&&K(),C(()=>e.trapped,t=>{t?K():D()})}),R(()=>{e.trapped&&D(),o.value&&(o.value.removeEventListener("keydown",p),o.value.removeEventListener("focusin",_),o.value.removeEventListener("focusout",g),o.value=void 0)}),{onKeydown:p}}});function ge(e,n,o,s,a,c){return re(e.$slots,"default",{handleKeydown:e.onKeydown})}var Oe=se(_e,[["render",ge],["__file","focus-trap.vue"]]);export{Oe as E,Ee as F,ee as a,we as f,Ce as g,fe as i,he as o,l as t};
